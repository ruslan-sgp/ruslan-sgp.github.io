<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Turing Machine Tape</title>
    <style>
        :root {
            --cell-size: 42px;
            --c0: #fde68a;
            --c1: #dbeafe;
            --cl: #f2f2f2;
            --border: #cbd5e1;
            --text: #0f172a;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            color: var(--text);
            background: #ffffff;
        }

        h1 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        button {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 13px;
        }

        button:hover {
            background: #f8fafc;
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-bottom: 14px;
            align-items: center;
        }

        .rows {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .row {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .cells {
            display: grid;
            gap: 4px;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            user-select: none;
        }

        .cell[data-val="0"] {
            background: var(--c0);
        }

        .cell[data-val="1"] {
            background: var(--c1);
        }

        .cell[data-val="λ"] {
            background: var(--cl);
        }

        .row-controls {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .info-box {
            display: flex;
            gap: 12px;
            font-size: 13px;
            align-items: center;
        }

        .info-seg {
            padding: 2px 6px;
            border-radius: 6px;
            background: #f1f5f9;
        }

        .label {
            font-weight: 600;
            letter-spacing: 0.03em;
            opacity: 0.85;
        }
    </style>
</head>

<body>
    <h1>Turing Machine Tape</h1>

    <div class="controls">
        <span>Cells:</span>
        <button onclick="changeCells(-1)">−</button>
        <button onclick="changeCells(1)">+</button>
        <span>Rows:</span>
        <button onclick="changeRows(-1)">−</button>
        <button onclick="changeRows(1)">+</button>
    </div>

    <div id="rows" class="rows"></div>

    <script>
        let cellCount = 10;
        const symbols = ['0', '1', 'λ'];
        const rowsEl = document.getElementById('rows');

        function rotate(cell) {
            const i = symbols.indexOf(cell.dataset.val);
            const next = symbols[(i + 1) % symbols.length];
            cell.dataset.val = next;
            cell.textContent = next;
        }

        function createCell(val = '0') {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.val = val;
            cell.textContent = val;
            return cell;
        }

        function createRow(existing = []) {
            const row = document.createElement('div');
            row.className = 'row';

            let headPos = 0;
            let state = 0;

            const stateColors = [
                '#1f2937', '#2563eb', '#16a34a', '#dc2626', '#7c3aed', '#ea580c',
                '#0891b2', '#ca8a04', '#be123c', '#0f766e', '#4f46e5', '#9333ea',
                '#15803d', '#b45309', '#0369a1'
            ];

            const cells = document.createElement('div');
            cells.className = 'cells';
            cells.style.gridTemplateColumns = `repeat(${cellCount}, var(--cell-size))`;

            const info = document.createElement('div');
            info.className = 'info-box';

            const stateEl = document.createElement('div');
            stateEl.style.fontWeight = '700';

            const leftEl = document.createElement('div');
            leftEl.className = 'info-seg';

            const rightEl = document.createElement('div');
            rightEl.className = 'info-seg';

            const totalEl = document.createElement('div');
            totalEl.className = 'info-seg';

            info.appendChild(stateEl);
            info.appendChild(leftEl);
            info.appendChild(rightEl);
            info.appendChild(totalEl);

            function count(list) {
                let c0 = 0, c1 = 0;
                list.forEach(c => {
                    if (c.dataset.val === '0') c0++;
                    if (c.dataset.val === '1') c1++;
                });
                return { c0, c1 };
            }

            function updateHead() {
                [...cells.children].forEach((c, i) => {
                    c.style.outline = i === headPos ? `2px solid ${stateColors[state % stateColors.length]}` : 'none';
                });
            }

            function updateInfo() {
                const all = [...cells.children];
                const left = count(all.slice(0, headPos));
                const right = count(all.slice(headPos + 1));
                const total = count(all);
                const color = stateColors[state % stateColors.length];

                stateEl.textContent = `q${state}`;
                stateEl.style.color = color;

                leftEl.innerHTML = `<span class="label">L</span> <span class="label">0</span>: ${left.c0} <span class="label">1</span>: ${left.c1}`;
                rightEl.innerHTML = `<span class="label">R</span> <span class="label">0</span>: ${right.c0} <span class="label">1</span>: ${right.c1}`;
                totalEl.innerHTML = `<span class="label">T</span> <span class="label">0</span>: ${total.c0} <span class="label">1</span>: ${total.c1}`;
            }

            for (let i = 0; i < cellCount; i++) {
                const cell = createCell(existing[i] || '0');
                cell.onclick = () => {
                    rotate(cell);
                    headPos = i;
                    updateHead();
                    updateInfo();
                };
                cells.appendChild(cell);
            }

            const controls = document.createElement('div');
            controls.className = 'row-controls';
            controls.innerHTML = `
        <button data-move="-1">◀</button>
        <button data-move="1">▶</button>
        <button data-state="-1">q−</button>
        <button data-state="1">q+</button>
        <button data-act="0">Reset 0</button>
        <button data-act="1">Reset 1</button>
        <button data-act="λ">Reset λ</button>
        <button data-act="rnd">Randomize 0/1</button>
      `;

            controls.onclick = e => {
                if (e.target.dataset.move) headPos = Math.max(0, Math.min(cellCount - 1, headPos + Number(e.target.dataset.move)));
                if (e.target.dataset.state) state += Number(e.target.dataset.state);
                if (e.target.dataset.act) {
                    const act = e.target.dataset.act;
                    [...cells.children].forEach(c => {
                        let v = act;
                        if (act === 'rnd') v = Math.random() < 0.5 ? '0' : '1';
                        c.dataset.val = v;
                        c.textContent = v;
                    });
                }
                updateHead();
                updateInfo();
            };

            row.appendChild(cells);
            row.appendChild(info);
            row.appendChild(controls);
            updateHead();
            updateInfo();
            return row;
        }

        function snapshot() {
            return [...rowsEl.children].map(r =>
                [...r.querySelectorAll('.cell')].map(c => c.dataset.val)
            );
        }

        function render(data) {
            rowsEl.innerHTML = '';
            data.forEach(r => rowsEl.appendChild(createRow(r)));
        }

        function changeCells(d) {
            const snap = snapshot();
            cellCount = Math.max(1, cellCount + d);
            render(snap);
        }

        function changeRows(d) {
            const snap = snapshot();
            if (d > 0) snap.push([]);
            if (d < 0 && snap.length > 1) snap.pop();
            render(snap);
        }

        render([[]]);
    </script>
</body>

</html>